#!/bin/bash

set -e

if username=$(ctx relationship target_node attributes username) ; then
    echo "$username (from attribute)"
else
    username=$(ctx relationship target_node properties username)
    echo "$username (from property)"
fi

# TODO: pick a random entry from a common password list
arr[0]="123456"
arr[1]="qwerty"
arr[2]="password"
arr[3]="letmein"
arr[4]="secret"
arr[5]="iloveyou"
arr[6]="monkey"
arr[7]="welcome"
arr[8]="dragon"
arr[9]="master"
arr[10]="hello"

rand=$[$RANDOM % ${#arr[@]}]

password=${arr[$rand]}

ctx relationship target_node attributes password = $password

if [ "$username" != "" ]; then
    echo "Changing $username password to $password"

    echo "$username:$password" | chpasswd
else
    echo "Ooops! Username is empty :(("
fi
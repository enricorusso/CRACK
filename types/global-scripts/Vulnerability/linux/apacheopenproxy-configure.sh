set -e

ID="unknown"
test -f /etc/os-release && source /etc/os-release

if [ "$proxy_url" != "" ]; then
    echo "Proxy: $proxy_url"
    export http_proxy="$proxy_url"
    export https_proxy="$proxy_url"
fi

echo -n "Distro: "
case $ID in
    ubuntu|debian)
        echo "ubuntu/debian"

        a2enmod proxy proxy_http proxy_connect
        sed -i 's/#ProxyRequests On/ProxyRequests On\nAllowConnect 443 10000/g' /etc/apache2/mods-available/proxy.conf
        apache2ctl restart
        ;;
    *)
        echo "distro $ID not supported :("
        ;;
esac
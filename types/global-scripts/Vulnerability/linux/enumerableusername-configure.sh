#!/bin/bash

set -e

olduser=$(ctx relationship target_node attributes username)

# TODO: choose a random enumerable user from a list..
arr[0]="admin"
arr[1]="backup"
arr[2]="operator"
arr[3]="manager"
arr[4]="webmaster"
arr[5]="demo"
arr[6]="sql"
arr[7]="dbadmin"
arr[8]="helpdesk"
arr[9]="sysop"

rand=$[$RANDOM % ${#arr[@]}]

username=${arr[$rand]}

echo "Changing username $olduser -> $username"

usermod -d /home/$username -l $username -m $olduser
getent group $username || (getent group $olduser && groupmod -n $username $olduser)

ctx relationship target_node attributes username = $username